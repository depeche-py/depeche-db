
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../../getting-started/executor/" rel="prev"/>
<link href="../subscriptions/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-9.0.11" name="generator"/>
<title>Data model - Depeche DB</title>
<link href="../../assets/stylesheets/main.0d440cfe.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.2505c338.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="" data-md-color-primary="" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#data-model">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Depeche DB" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Depeche DB">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Depeche DB
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Data model
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Depeche DB" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Depeche DB">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    Depeche DB
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        Home
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Getting started
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Getting started
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/installation/">
        Installation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/write-read/">
        Writing &amp; reading messages
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/aggregated-stream/">
        Aggregated streams
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/subscription/">
        Subscription
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/executor/">
        Executor
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Concepts
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Concepts
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Data model
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Data model
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#messages">
    Messages
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#streams">
    Streams
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#message-store">
    Message store
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#aggregated-streams">
    Aggregated streams
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../subscriptions/">
        Subscriptions
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#messages">
    Messages
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#streams">
    Streams
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#message-store">
    Message store
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#aggregated-streams">
    Aggregated streams
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="data-model">Data model</h1>
<h2 id="messages">Messages</h2>
<p>The smallest unit of storage is a message. The content of messages is transparent
to Depeche DB. Every message needs two basic properties so that it can be stored
and processed: An <code>ID</code> of type UUID and a timestamp.</p>
<h2 id="streams">Streams</h2>
<p>A stream has a name and contains messages. The message store can contain as many
streams as you need.</p>
<p><div class="mermaid">flowchart TB
    subgraph stream-1
    msg11 --&gt; msg12 --&gt; msg13
    end
</div>
<div class="mermaid">flowchart TB
    subgraph stream-2
    msg21 --&gt; msg22
    end
</div></p>
<p>Messages in a stream are ordered. Their position within the stream is called
<code>version</code>. The <code>version</code>s in a stream do not have gaps and are unique.</p>
<p>Usually, a stream will be relatively small because it only contains messages
concerning a single domain object.</p>
<h2 id="message-store">Message store</h2>
<p>The message store contains multiple streams. Messages are assigned a global
position when they are added to a stream. This global position is unique but
there can be gaps (when transactions are rolled back). For messages <code>a</code> and <code>b</code>
within the same stream, it is guaranteed that if <code>a.version &lt; b.version</code> then
<code>a.global_position &lt; b.global_position</code> and vice versa.</p>
<h2 id="aggregated-streams">Aggregated streams</h2>
<p>Because of the high granularity of the streams, it is not pratical to subscribe
to them directly. That is why there is the notion of an aggregated stream which
aggregates the messages from several streams.</p>
<p>Aggregated streams consist of partitions. Messages from the origin streams
can be assigned to partitions by a user defined function. When a message is
added to a partition within an aggregated stream, it is <strong>not</strong> copied but linked
to. Thus, aggregated streams are rather light-weight on the storage size.</p>
<p>Given these streams:
<div class="mermaid">flowchart TB
    subgraph stream-1
    msg11 --&gt; msg12 --&gt; msg13
    style msg11 fill:#feaaaa
    style msg12 fill:#feaaaa
    style msg13 fill:#feaaaa
    end
    subgraph stream-2
    msg21 --&gt; msg22
    style msg21 fill:#aafeaa
    style msg22 fill:#aafeaa
    end
    subgraph stream-3
    msg31 --&gt; msg32
    style msg31 fill:#aaaafe
    style msg32 fill:#aaaafe
    end
</div></p>
<p>An aggregated stream could look like this:
<div class="mermaid">flowchart TB
    subgraph partition-1
      p11 --&gt; p12 --&gt; p31 --&gt; p13 --&gt; p32
      style p11 fill:#feaaaa
      style p12 fill:#feaaaa
      style p13 fill:#feaaaa
      style p31 fill:#aaaafe
      style p32 fill:#aaaafe
    end
</div>
<div class="mermaid">flowchart TB
    subgraph partition-2
      p21 --&gt; p22
      style p21 fill:#aafeaa
      style p22 fill:#aafeaa
    end
</div></p>
<p>Within a partition, messages are ordered by their global position in the
message store. Messages are assigned a unique &amp; gapless <code>position</code> within their
partition.</p>
<p>Please note that this example partitioning (which used the stream name as the
partition key) is only one possibility. Users can define how messages are
partitioned. Furthermore, you can create multiple aggregated streams which
contain the same or overlapping sets of messages with different partitioning
strategies. This allows you to tailor the aggregated streams - more
specifically their ordering and possible parallelism - to the needs of
different consumers.</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand"], "search": "../../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.6df46069.min.js"></script>
<script src="https://unpkg.com/mermaid@9.3.0/dist/mermaid.min.js"></script><script>mermaid.initialize({});</script></body>
</html>